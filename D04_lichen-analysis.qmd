# Lichen Data Analysis {#sec-lichen-data-analysis}

```{r}
#| label: set-up
#| include: false
#| message: false
#| error: false
#| warning: false

# load libraries for reporting
library(knitr)

# load libraries for data import
library(readr)
library(here)
library(janitor)

# load libraries for data wrangling
library(dplyr)
library(tidyr)
library(tibble)
library(tidyselect)

# load libraries for plotting
library(ggplot2)
library(ggthemes)
library(OpenStreetMap)
library(sf)
library(osmdata)
library(ggmap)

# load library for stats
library(infer)

# pick a set of colors (you have up 6 sample locations)
col_loc <- c("#555599", "cyan", "gold", 
            "darkorange", "darkblue", "darkred")

col_tree_density <- c("#DE99D9", "#E021DA", "#470544")

col_tree_type <- c("darkgreen", "green")

col_side <- c("cyan", "darkorange", "purple", "gold")

set.seed(42)

# set options
knitr::opts_chunk$set(
  tidy = FALSE, 
  message = FALSE,
  warning = FALSE)

options(htmltools.dir.version = FALSE)

```

## Get set up to analyze your data

::: {.callout-warning title="Heads up"}
Two weeks ago, each of you formulated two hypotheses of important abiotic and biotic variables determining presence/absence, distribution, and type of lichen present in local microhabitats. This means that each of you will be analyzing different aspects of your data set. As such we will have you working directly in your lab report to analyze your data and describe your results. Before you go today, make sure you can render your report (i.e. all the tables and figures are being produced and your code is running smoothly).

We have two quarto documents available for you, the first will render to an `html`-file as you are used to from previous projects this semester, the second with convert to an editable `*.docx`-file.

Take some notes during class room discussions for you to be able to use when you finalize your introduction, methods, results, and discussion section and turn in your report.
:::

Before you get started you will need to download your data set from our shared drive. As usual, go to the `GoogleSheet`, select `File` -> `Download` and then `Tab Seperated Values (tsv)`. Then rename the file to `lichen-survey.tsv` and move to your `data` folder in your current project folder.

In the next section we will generate a sample map that you should include in your methods section of your report. You can download the file from the `results` files on the google drive and move it into your current `Rproject` folder, and then insert in your methods section in the `Study Area/Site Description` section.

## Data Exploration

### Explore sample locations (micro-habitats)

```{r}
#| label: fig-map
#| fig-cap: "Sample Area Saint Anselm Campus Lichen survey. Individual dots represent sampled trees. Colors correspond to sample areas."
#| message: false
#| error: false
#| warning: false

lichen <- read_delim("data/lichen-survey.tsv") %>%
  clean_names() %>%
  mutate(tree_density = ordered(tree_density,
                                levels = c("free-standing", 
                                           "small-group", 
                                           "continuous-forest")))

# get lat/long for plot boundaries
min_lat <- min(lichen$latitude, na.rm = TRUE)
max_lat <- max(lichen$latitude, na.rm = TRUE)

min_long <- min(lichen$longitude, na.rm = TRUE)
max_long <- max(lichen$longitude, na.rm = TRUE)

# pull major street features
big_streets <- opq(bbox = c(min_long-0.0025, min_lat-0.0025, 
                            max_long+0.0025, max_lat+0.0025),
                   memsize = 2e9) %>%
  add_osm_feature(key = "highway", 
                  value = c("motorway", "primary", "motorway_link", "primary_link")) %>%
  osmdata_sf()

# pull medium sized streets
med_streets <- opq(bbox = c(min_long-0.0025, min_lat-0.0025, 
                            max_long+0.0025, max_lat+0.0025),
                   memsize = 2e9) %>%
  add_osm_feature(key = "highway", 
                  value = c("secondary", "tertiary", "secondary_link", "tertiary_link")) %>%
  osmdata_sf()

# pull small streets
small_streets <- opq(bbox = c(min_long-0.0025, min_lat-0.0025, 
                              max_long+0.0025, max_lat+0.0025),
                   memsize = 2e9) %>%
  add_osm_feature(key = "highway", 
                  value = c("residential", "living_street",
                            "unclassified",
                            "service", "footway")) %>%
  osmdata_sf()

# pull rivers
rivers <- opq(bbox = c(min_long-0.0025, min_lat-0.0025, 
                       max_long+0.0025, max_lat+0.0025),
                   memsize = 2e9) %>%
  add_osm_feature(key = "waterway", value = "river") %>%
  osmdata_sf()

# pull railways
railway <- opq(bbox = c(min_long-0.0025, min_lat-0.0025, 
                        max_long+0.0025, max_lat+0.0025),
                   memsize = 2e9) %>%
  add_osm_feature(key = "railway", value="rail") %>%
  osmdata_sf()

# compile plot
ggplot() +
  geom_sf(data = rivers$osm_lines,
          inherit.aes = FALSE,
          color = "steelblue",
          size = .8,
          alpha = .3) +
  geom_sf(data = railway$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = .2,
          linetype="dotdash",
          alpha = .5) +
  geom_sf(data = med_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1.5,
          alpha = 1) +
  geom_sf(data = small_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1,
          alpha = 1) +
  geom_sf(data = big_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 2,
          alpha = 1) +
  coord_sf(xlim = c(min_long-0.0025, max_long+0.0025), 
           ylim = c(min_lat-0.001, max_lat+0.001),
           expand = FALSE) +
  geom_point(data = lichen, 
             aes(x = longitude, y = latitude, color = sample_location), 
             size = 1.5, alpha = 1) +
  scale_color_manual(values = col_loc) +
  theme_bw() +
  theme(legend.position = "bottom")

ggsave("results/map_sample-locations.jpg", dpi = 300)

```

::: {.callout-tip title="Consider this"}
We sampled five locations on campus. For many of the question you are interested in the differences in those locations are relevant because they differ in the type of habitat, distance to streets, amount of traffic (cars, people), type of trees, tree density, amount of buildings etc. Think about how the differences in sample location might be important for the hypotheses that you are interested in thinking about and take a few notes to include in your study design section.

Completing a comprehensive survey across campus both allows us to look at differences at a microhabitat level (differences among locations on campus) as well as look at some broad-scale patterns to determine if they are significant across a range of conditions - i.e. it allows us to account for confounding variables.

*Note: if you are interested in patterns like the effect of tree size on lichen coverage then the fact that you sampled across a range of different types of locations might be an important component because you can eliminate confounding factors that might have played a role in just one location.*

:::

Let's look at our data and see how some of our explanatory variables vary across campus, let's start with our categorical explanatory variables:

Instead of measuring sunlight directly or canopy coverage, we have classified trees as being free-standing, in small groups, or in forested area where a continuous canopy is likely:

```{r}
#| label: tbl-summary-table-tree-density
#| tbl-cap: "."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_explanatory <- "tree_density"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  count(!!sym(col_explanatory)) %>%
  pivot_wider(names_from = "sample_location",
              values_from = "n") %>%
  kable()

```

We can also re-plot our map color coded by tree-density to get some insight into how these areas differ in terms of habitat.

```{r}
#| label: fig-map-density
#| fig-cap: "Sample Area Saint Anselm Campus Lichen survey. Individual dots represent sampled trees. Colors correspond to tree density."
#| message: false
#| error: false
#| warning: false
#| cache: true

# compile plot
ggplot() +
  geom_sf(data = rivers$osm_lines,
          inherit.aes = FALSE,
          color = "steelblue",
          size = .8,
          alpha = .3) +
  geom_sf(data = railway$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = .2,
          linetype="dotdash",
          alpha = .5) +
  geom_sf(data = med_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1.5,
          alpha = 1) +
  geom_sf(data = small_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1,
          alpha = 1) +
  geom_sf(data = big_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 2,
          alpha = 1) +
  coord_sf(xlim = c(min_long-0.0025, max_long+0.0025), 
           ylim = c(min_lat-0.001, max_lat+0.001),
           expand = FALSE) +
  geom_point(data = lichen, 
             aes(x = longitude, y = latitude, color = tree_density), 
             size = 1.5, alpha = 1) +
  scale_color_manual(values = col_tree_density) +
  theme_bw() +
  theme(legend.position = "bottom")

ggsave("results/map_tree-density.jpg", dpi = 300)

```

Another important question is whether our locations differ by tree type:

```{r}
#| label: tbl-summary-table-tree-type
#| tbl-cap: "."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_explanatory <- "tree_type"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  count(!!sym(col_explanatory)) %>%
  pivot_wider(names_from = "sample_location",
              values_from = "n") %>%
  kable()

```

Again, we can re-plot our map to see if there are differences in terms of how our sample locations differ by pre-dominant tree type.

```{r}
#| label: fig-map-type
#| fig-cap: "Sample Area Saint Anselm Campus Lichen survey. Individual dots represent sampled trees. Colors correspond to tree type."
#| message: false
#| error: false
#| warning: false
#| cache: true

# compile plot
ggplot() +
  geom_sf(data = rivers$osm_lines,
          inherit.aes = FALSE,
          color = "steelblue",
          size = .8,
          alpha = .3) +
  geom_sf(data = railway$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = .2,
          linetype="dotdash",
          alpha = .5) +
  geom_sf(data = med_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1.5,
          alpha = 1) +
  geom_sf(data = small_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1,
          alpha = 1) +
  geom_sf(data = big_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 2,
          alpha = 1) +
  coord_sf(xlim = c(min_long-0.0025, max_long+0.0025), 
           ylim = c(min_lat-0.001, max_lat+0.001),
           expand = FALSE) +
  geom_point(data = lichen, 
             aes(x = longitude, y = latitude, color = tree_type), 
             size = 1.5, alpha = 1) +
  scale_color_manual(values = col_tree_type) +
  theme_bw() +
  theme(legend.position = "bottom")

ggsave("results/map_tree-type.jpg", dpi = 300)

```

Now let's take a look at some of our continuous explanatory variables:

We determined the dbh (diameter at breast height) which is indicative of how large trees are and to a certain extent age.

```{r}
#| label: tbl-summary-table-dbh
#| tbl-cap: "Comparison of mean dbh (diameter at breast height) by sample location."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "dbh_cm"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

We can create a color-scale to compare the dbh across the different sample locations on a map.

```{r}
#| label: fig-map-dbh
#| fig-cap: "Sample Area Saint Anselm Campus Lichen survey. Individual dots represent sampled trees. Colors correspond to dbh (diameter at breast height)."
#| message: false
#| error: false
#| warning: false
#| cache: true

# compile plot
ggplot() +
  geom_sf(data = rivers$osm_lines,
          inherit.aes = FALSE,
          color = "steelblue",
          size = .8,
          alpha = .3) +
  geom_sf(data = railway$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = .2,
          linetype="dotdash",
          alpha = .5) +
  geom_sf(data = med_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1.5,
          alpha = 1) +
  geom_sf(data = small_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1,
          alpha = 1) +
  geom_sf(data = big_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 2,
          alpha = 1) +
  coord_sf(xlim = c(min_long-0.0025, max_long+0.0025), 
           ylim = c(min_lat-0.001, max_lat+0.001),
           expand = FALSE) +
  geom_point(data = lichen, 
             aes(x = longitude, y = latitude, color = dbh_cm), 
             size = 1.5, alpha = .75) +
  scale_color_viridis_c() +
  theme_bw() +
  theme(legend.position = "bottom")

ggsave("results/map_dbh.jpg", dpi = 300)

```

Finally, we measured bark pH. The pH of different trees varies by species. Additionally, several studies have shown that air pollution can impact bark pH.

```{r}
#| label: tbl-summary-table-ph
#| tbl-cap: "Comparison of bark pH by sample location."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "bark_ph"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

Again, we can create a color-scale to compare the dbh across the different sample locations on a map.

```{r}
#| label: fig-map-ph
#| fig-cap: "Sample Area Saint Anselm Campus Lichen survey. Individual dots represent sampled trees. Colors correspond to level of bark pH."
#| message: false
#| error: false
#| warning: false
#| cache: true

# compile plot
ggplot() +
  geom_sf(data = rivers$osm_lines,
          inherit.aes = FALSE,
          color = "steelblue",
          size = .8,
          alpha = .3) +
  geom_sf(data = railway$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = .2,
          linetype="dotdash",
          alpha = .5) +
  geom_sf(data = med_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1.5,
          alpha = 1) +
  geom_sf(data = small_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 1,
          alpha = 1) +
  geom_sf(data = big_streets$osm_lines,
          inherit.aes = FALSE,
          color = "black",
          size = 2,
          alpha = 1) +
  coord_sf(xlim = c(min_long-0.0025, max_long+0.0025), 
           ylim = c(min_lat-0.001, max_lat+0.001),
           expand = FALSE) +
  geom_point(data = lichen, 
             aes(x = longitude, y = latitude, color = bark_ph), 
             size = 1.5, alpha = .75) +
  scale_color_viridis_c() +
  theme_bw() +
  theme(legend.position = "bottom")

ggsave("results/map_ph.jpg", dpi = 300)

```

Now that we have thought through our sample design in terms of different habitats we have sampled let's take a look at the different key relationships we can learn about.

## Sample location

### Effect of sample location on lichen coverage

Location itself can be an explanatory variable given the differences in habitat. Let's take a look at whether or not location has a significant on the total observed lichen coverage.

First, let's take a look at the mean lichen coverage and variability in our data set.

```{r}
#| label: tbl-lichen-coverage
#| tbl-cap: "Descriptive statistics of lichen coverage summed across north, south, east, and west side of the tree across all locations."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_total"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Now, let's describe the central tendencies and variability of total lichen coverage across the different sample locations.

```{r}
#| label: tbl-location-lichen-coverage
#| tbl-cap: "Descriptive statistics of lichen coverage summed across north, south, east, and west side of the tree for each sample location."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_total"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Our next step will be to create a summary figure and use an anova to determine if the observed differences are random or due to sample location.

```{r}
#| label: fig-location-lichen-coverage
#| fig-cap: "Comparison of total lichen coverage per tree for all campus sample locations."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "sample_location"
x_axis_title <- "campus sample location"

# specify the column that contains your response (dependent) variable 
col_response <- "coverage_total"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

summary <- lichen %>%
  group_by(!!sym(col_explanatory)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = !!sym(col_explanatory),
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = !!sym(col_explanatory)),
                size = 1.2) +
  scale_color_manual(values = col_loc) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(reformulate(col_explanatory, col_response),
    data = lichen) %>%
  summary

```

We see that overall despite the observed differences in the calculated means, location does not have a significant effect on lichen coverage. In your discussion consider why sample location might not have a significant effect in our data set; you will want to look at your class mates results and those presented in this chapter to see whether for example our sample locations weren't chosen well enough to represent differences in factors that impact lichen growth. Consider how you might refine the survey or expand the data set to improve your understanding of differences of sample location on overall lichen coverage.

### Effect of sample location on air quality

We can use lichen as a bioindicator to determine if there are differences in air quality across sample locations on campus.

First, let's take a look at the mean air quality index scores and variability in the data set overall.

```{r}
#| label: tbl-air-quality
#| tbl-cap: "Descriptive statistics of air quality indicated by lichen morphotype present on trees."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "air_quality_index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Next, let's describe the central tendencies and variability of the air quality index across the different sample locations.

```{r}
#| label: tbl-location-air-quality
#| tbl-cap: "Descriptive statistics of lichen coverage summed across north, south, east, and west side of the tree for each sample location."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "air_quality_index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Our next step will be to create a summary figure and use an anova to determine if the observed differences are random or due to sample location.

```{r}
#| label: fig-location-air-quality
#| fig-cap: "Comparison of air quality index based on lichen morphotype across all campus sample locations."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "sample_location"
x_axis_title <- "campus sample location"

# specify the column that contains your response (dependent) variable 
col_response <- "air_quality_index"
y_axis_title <- "air quality index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

summary <- lichen %>%
  group_by(!!sym(col_explanatory)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = !!sym(col_explanatory),
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = !!sym(col_explanatory)),
                size = 1.2) +
  scale_color_manual(values = col_loc) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(reformulate(col_explanatory, col_response),
    data = lichen) %>%
  summary

```

Sample location has a significant impact on air quality. When you discuss your results, be sure to consider differences in those sample locations that could be indicative of why we observe these differences. If they do not match your expectations, consider alternative explanations of why you might be observing the more sensitive lichen morphotypes in areas that you may have not initially expected to see them. Consider how you might refine the survey, e.g. in terms of how you chose your sample locations for future steps to better understand the relationship you have identified here.

## Tree density

### Effect of tree density on lichen coverage

The tree density will play a role in the access of sunlight. Sunlight is required for photosynthesis, however, more sunlight could also mean a higher level of evaporation and less water available for lichen to grow.

We characterized differences in the tree density by sample location earlier^[This will be important when you consider if there are confounding factors when you interpret the results!], so we can get right to calculating describing the central tendencies and variability of total lichen coverage for different levels of tree density.

```{r}
#| label: tbl-tree-density-lichen-coverage
#| tbl-cap: "Descriptive statistics of lichen coverage for different levels of tree density."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_total"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Our next step will be to create a summary figure and use an anova to determine if the observed differences are random or due to tree density.

```{r}
#| label: fig-tree-density-lichen-coverage
#| fig-cap: "Comparison of total lichen coverage per tree for different levels of tree density."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "tree_density"
x_axis_title <- "tree density"

# specify the column that contains your response (dependent) variable 
col_response <- "coverage_total"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

summary <- lichen %>%
  group_by(!!sym(col_explanatory)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = !!sym(col_explanatory),
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = !!sym(col_explanatory)),
                size = 1.2) +
  scale_color_manual(values = col_tree_density) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(reformulate(col_explanatory, col_response),
    data = lichen) %>%
  summary

```

We see that tree density has a significant effect on the lichen coverage. For your discussion, you will want to discuss which factors could contribute to this observed pattern (photosynthesis, water evaporation). Additionally, you will want to consider how you could further refine your study to better understand this pattern.

### Effect of tree density on air quality index

We can use lichen as a bioindicator to determine if there are differences in air quality across sample locations on campus; tree density has been shown to be a factor that can alleviate air quality. We can use our data set to determine if tree density has a significant impact on the observed lichen air quality index.

First, let's take a look at the mean air quality index scores and variability in the data set by tree density.

```{r}
#| label: tbl-tree-density-air-quality
#| tbl-cap: "Descriptive statistics of lichen coverage by tree density."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "air_quality_index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Our next step will be to create a summary figure and use an anova to determine if the observed differences are random or due to sample location.

```{r}
#| label: fig-tree-density-air-quality
#| fig-cap: "Comparison of air quality index based on lichen morphotype by tree density."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "tree_density"
x_axis_title <- "tree density"

# specify the column that contains your response (dependent) variable 
col_response <- "air_quality_index"
y_axis_title <- "air quality index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

summary <- lichen %>%
  group_by(!!sym(col_explanatory)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = !!sym(col_explanatory),
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = !!sym(col_explanatory)),
                size = 1.2) +
  scale_color_manual(values = col_tree_density) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(reformulate(col_explanatory, col_response),
    data = lichen) %>%
  summary

```

Tree density does not have a significant effect on tree density. For your discussion, consider how you will interpret this result and how you might need to refine the study to better understand the impact of tree density on air quality.


## Effect of tree size on lichen coverage

We already took a look at how tree size varies across sample locations. Let's take a quick look at how it varies across the data set overall.

```{r}
#| label: tbl-dbh_cm
#| tbl-cap: "Descriptive statistics of dbh (diameter at breast height)."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "dbh_cm"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Next, let's plot a linear regression and determine whether the relationship is significant, and if so, what proportion of the variability in the lichen coverage is explained by tree size.

```{r}
#| label: fig-dbh-lichen-coverage
#| fig-cap: "Relationship of dbh (diamter at breast height) and lichen coverage."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "dbh_cm"
x_axis_title <- "diameter at breast height [cm]"

# specify the column that contains your response (dependent) variable 
col_response <- "coverage_total"
y_axis_title <- "total lichen coverage"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create plot
ggplot(lichen,
       aes(x = !!sym(col_explanatory),
           y = !!sym(col_response))) +
  stat_smooth(method = "lm") +
  geom_point() +
  labs(x = x_axis_title,
       y = y_axis_title) +
  theme_classic()

# test relationship
lm(formula = reformulate(col_explanatory, col_response),
                 data = lichen) %>% 
  summary()

```

The relationship is significant, though only a small proportion of the variability in coverage is explained by the diameter. In your discussion, consider why tree size impacts lichen coverage. You will will not only want to think about the direct impact (larger tree = more surface area) but also what other factors are parameterized by a larger tree (e.g. the age of a tree). You will also want to consider why despite the relationship being significant only a small proportion of the variability is explained and how you might further refine your investigation in future studies to better understand what other factors impact lichen coverage along side tree size.

## Effect of tree type on lichen coverage

The substrate is an important factor determining lichen presence and abundance. We only sampled one substrate (trees), however, we can look at differences in tree type to see if that impacts the lichen coverage.

We already looked at how tree density differs among sample locations, but we probably also want to know if there is a significant bias in terms of the number of trees for each category in our overall data set

```{r}
#| label: tbl-tree-density
#| tbl-cap: "Number of coniferous and deciduous trees sampled"
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_explanatory <- "tree_type"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  count(!!sym(col_explanatory)) %>%
  kable()

```

We have sampled more than twice the amount of deciduous trees. Keep this in mind when you interpret your data set.

Let's calculate differences in central tendency and variability of lichen coverage for different tree types.

```{r}
#| label: tbl-tree-type-coverage
#| tbl-cap: "Descriptive statistics of lichen coverage depending on tree type."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_type"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_total"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)),
            min = min(!!sym(col_response)),
            max = max(!!sym(col_response))) %>%
  kable()

```

Next, let's plot a linear regression and determine whether the relationship is significant, and if so, what proportion of the variability in the lichen coverage is explained by tree type.

```{r}
#| label: fig-tree-type-lichen-coverage
#| fig-cap: "Comparison of total lichen coverage per tree for different tree types."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "tree_type"
x_axis_title <- "tree type"

# specify the column that contains your response (dependent) variable 
col_response <- "coverage_total"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

summary <- lichen %>%
  group_by(!!sym(col_explanatory)) %>%
  summarize(mean = mean(!!sym(col_response)),
            sd = sd(!!sym(col_response)))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = !!sym(col_explanatory),
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = !!sym(col_explanatory)),
                size = 1.2) +
  scale_color_manual(values = col_tree_type) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(reformulate(col_explanatory, col_response),
    data = lichen) %>%
  summary

```

This relationship is not significant. For your discussion, you will want to consider why it makes sense that we do not observe significant differences as well as how you might refine the study in the future to further investigate this relationship, for example, because of the time of year we sampled, we were not able to easily identify each tree to a species level.


## Bark ph

## Effect of bark pH on lichen coverage

Classifying trees coniferous or deciduous to test for effects of different substrate types on lichen coverage may have been to broad. By testing for differences in bark pH, we can look at one specific abiotic factor that can be a key determinant for organisms and their ability to colonize a substrate.

We already assessed broad patterns of bark pH by sample location. Let's take a look at how pH varied across the data set.

```{r}
#| label: tbl-ph
#| tbl-cap: "Descriptive statistics of bark pH."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "bark_ph"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

We probably also want to know if there are differences in the central tendency and variability of the bark pH for the two types of trees we sampled:

```{r}
#| label: tbl-ph-tree-type
#| tbl-cap: "Descriptive statistics of bark pH for each tree type."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_type"

# specify  column that contains data to summarize (response variable)
col_response <- "bark_ph"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

Next, let's create a plot showing the relationship of bark pH and lichen abundance and test whether the relationship is linear; if it is significant, we will also be able to determine which proportion of the variability in lichen abundance is explained by differences in the bark pH.

```{r}
#| label: fig-pH-abundance
#| fig-cap: "Relationship of bark pH and overall lichen abundance."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "bark_ph"
x_axis_title <- "Bark pH"

# specify the column that contains your response (dependent) variable 
col_response <- "coverage_total"
y_axis_title <- "total lichen coverage"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create plot
ggplot(lichen,
       aes(x = !!sym(col_explanatory),
           y = !!sym(col_response))) +
  stat_smooth(method = "lm") +
  geom_point() +
  labs(x = x_axis_title,
       y = y_axis_title) +
  theme_classic()

# test relationship
lm(formula = reformulate(col_explanatory, col_response),
                 data = lichen) %>% 
  summary()

```

This relationship is not significant. In your results consider why this might not be the case, and how we might need to refine our data set to better understand this relationship. For example, do you expect the relationship to be linear? Or might there be another relationship that makes more sense - how would you need to set up a study that can better investigate that relationship?

## Effect of bark pH on air quality index

While different trees have higher or lower bark pH in and of themselves, additionally, air pollution can cause changes in the pH of bark. Therefore, it is reasonable to test whether the pH of bark plays a significant role, explaining the observed variability of the air quality index based on presence of more sensitive lichen.

```{r}
#| label: fig-pH-air-qaulity
#| fig-cap: "Relationship of bark pH and air quality index based on observed lichen morphotypes."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify the column that contains your explanatory (independent) variable
col_explanatory <- "bark_ph"
x_axis_title <- "Bark pH"

# specify the column that contains your response (dependent) variable 
col_response <- "air_quality_index"
y_axis_title <- "air quality index"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create plot
ggplot(lichen,
       aes(x = !!sym(col_explanatory),
           y = !!sym(col_response))) +
  stat_smooth(method = "lm") +
  geom_point() +
  labs(x = x_axis_title,
       y = y_axis_title) +
  theme_classic()

# test relationship
lm(formula = reformulate(col_explanatory, col_response),
                 data = lichen) %>% 
  summary()

```

There is no significant differences in the observed air quality index based on bark pH.

## Aspect

### Effect of tree side on lichen coverage

So far, we have looked at overall lichen coverage. However, we did intentionally measure differences in lichen abundance for each side of the tree. To propery interpret these results, you will want to consider what variables could play into creating differences in lichen abundance according to the side of the tree that is observed. This could include both factors such as the amount of available sunlight, differences in evaporation/moisture of the tree as well as the fact that some of our sample locations differ in terms of the vicinity to buildings that could have additional effects in terms of impacting the amout of sun and how affected trees are by wind and other weather effects.

First, we will want to look at differences in central tendency and variability of coverage for different aspects of the tree.

```{r}
#| label: tbl-coverage-north-I
#| tbl-cap: "Descriptive statistics of lichen coverage on the north side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_north"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-east-I
#| tbl-cap: "Descriptive statistics of lichen coverage on the east side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_east"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-south-I
#| tbl-cap: "Descriptive statistics of lichen coverage on the south side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_south"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-west-II
#| tbl-cap: "Descriptive statistics of lichen coverage on the west side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "site"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_west"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

To compare differences in coverage depending on the side of the tree we have to do a little bit of manipulation of the data frame^[Shamefully, our dataset is not completely tidy - e.g coverage_west is not a variable, it should really be separate columns one for the direction/side of the tree and a second for the coverage. That would have made data entry an pain in the neck.].

```{r}
#| label: fig-side-of-tree
#| fig-cap: "Mean lichen coverage for north, east, west, and south aspect of sampled trees."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----
x_axis_title <- "Tree aspect"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create tidy data set with coverage by direction
df <- lichen %>%
  select(coverage_north, coverage_east, coverage_south, coverage_west) %>%
  pivot_longer(names_to = "tree_side", values_to = "coverage", 1:4) %>%
  separate(tree_side, into = c("tmp", "direction"), sep = "_") %>%
  select(-tmp)

# calculate summary stats
summary <- df %>%
  group_by(direction) %>%
  summarize(mean = mean(coverage),
            sd = sd(coverage))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = direction,
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = direction),
                size = 1.2) +
  scale_color_manual(values = col_side) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(coverage ~ direction,
    data = df) %>%
  summary()

```

The aspect of the tree, does not have a significant impact on the overall data set. As you consider why this might be the case, you will likely conclude that our sample locations differ in terms of proximity to buildings and also in terms of whether we typically have free-standing trees or trees that likely are shaded by a more dense canopy becacuse they are in more forested areas. 

Let's take a look at those two factors. To do this, we will need to do a nested analysis where we group by by side of the tree and by location or tree density. However, you can interpret the output of the two-way ANOVA the same way you have been interpreting the output of a (one-way) ANOVA.

### Differences in effect of tree side on lichen coverage by location

First, we will want to look at differences in central tendency and variability of coverage for different aspects of the tree grouped by location.

```{r}
#| label: tbl-coverage-north-II
#| tbl-cap: "Descriptive statistics of lichen coverage on the north side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_north"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-east-II
#| tbl-cap: "Descriptive statistics of lichen coverage on the east side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_east"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-south-II
#| tbl-cap: "Descriptive statistics of lichen coverage on the south side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_south"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-west-III
#| tbl-cap: "Descriptive statistics of lichen coverage on the west side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "sample_location"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_west"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

We can split our summary plot to include a subplot by sample location and run a two-way ANOVA. The questions we are asking are:

1. If we control for side of the tree, is sample location significant?
2. If we control for sample location, is side of the tree significant?

```{r}
#| label: fig-location-side-of-tree
#| fig-cap: "Mean lichen coverage for north, east, west, and south aspect of sampled trees for each sample location."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----
x_axis_title <- "Tree aspect"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create tidy data set with coverage by direction
df <- lichen %>%
  select(coverage_north, coverage_east, coverage_south, coverage_west, sample_location) %>%
  pivot_longer(names_to = "tree_side", values_to = "coverage", 1:4) %>%
  separate(tree_side, into = c("tmp", "direction"), sep = "_") %>%
  select(-tmp)

# calculate summary stats
summary <- df %>%
  group_by(direction, sample_location) %>%
  summarize(mean = mean(coverage),
            sd = sd(coverage))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = direction,
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = direction),
                size = 1.2) +
  facet_wrap(. ~ sample_location) +
  scale_color_manual(values = col_side) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(coverage ~ sample_location + direction,
    data = df) %>%
  summary()

```

This indicates that while overall there is no significance of differences in sample location or side of the tree, when we control for differences in side of the tree, overall there are differences in the patterns of lichen abundance for sample locations.


### Differences in effect of tree side on lichen coverage by tree density

First, we will want to look at differences in central tendency and variability of coverage for different aspects of the tree grouped by tree density

```{r}
#| label: tbl-coverage-north-III
#| tbl-cap: "Descriptive statistics of lichen coverage on the north side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_north"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-east-III
#| tbl-cap: "Descriptive statistics of lichen coverage on the east side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_east"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-south-III
#| tbl-cap: "Descriptive statistics of lichen coverage on the south side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_south"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

```{r}
#| label: tbl-coverage-west-I
#| tbl-cap: "Descriptive statistics of lichen coverage on the west side of the tree."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----

# specify column name to group data & calculate descriptive stats
col_grp <- "tree_density"

# specify  column that contains data to summarize (response variable)
col_response <- "coverage_west"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# calculate summary stats for continuous variable
lichen %>%
  group_by(!!sym(col_grp)) %>%
  summarize(mean = mean(!!sym(col_response), na.rm = TRUE),
            sd = sd(!!sym(col_response), na.rm = TRUE),
            min = min(!!sym(col_response), na.rm = TRUE),
            max = max(!!sym(col_response), na.rm = TRUE)) %>%
  kable()

```

We can split our summary plot to include a subplot by sample location and run a two-way ANOVA. The questions we are asking are:

1. If we control for side of the tree, is tree density significant?
2. If we control for tree density, is side of the tree significant?

```{r}
#| label: fig-location-tree-density-cov
#| fig-cap: "Mean lichen coverage for north, east, west, and south aspect of sampled trees for different levels of tree density."
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----
x_axis_title <- "Tree aspect"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create tidy data set with coverage by direction
df <- lichen %>%
  select(coverage_north, coverage_east, coverage_south, coverage_west, tree_density) %>%
  pivot_longer(names_to = "tree_side", values_to = "coverage", 1:4) %>%
  separate(tree_side, into = c("tmp", "direction"), sep = "_") %>%
  select(-tmp)

# calculate summary stats
summary <- df %>%
  group_by(direction, tree_density) %>%
  summarize(mean = mean(coverage),
            sd = sd(coverage))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = direction,
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = direction),
                size = 1.2) +
  facet_wrap(. ~ tree_density) +
  scale_color_manual(values = col_side) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme_classic() +
  theme(legend.position = "none")

# test relationship
aov(coverage ~ tree_density + direction,
    data = df) %>%
  summary()

```

This indicates that while overall there is no significance of differences in sample location or side of the tree, when we control for differences in side of the tree, overall there are differences in the patterns of lichen abundance for sample locations.

### Tree density and sample location

We can take this one step further to compare difference for tree density and sample location to really get into the effect of microhabitats.

```{r}
#| label: fig-location-density-side-of-tree
#| fig-cap: "Mean lichen coverage for north, east, west, and south aspect of sampled trees for different levels of tree density for each sample location."
#| fig-height: 10
#| message: false
#| error: false
#| warning: false

# MODIFY THIS SECTION ----
x_axis_title <- "Tree aspect"
y_axis_title <- "lichen relative abundance"

# DO NOT MAKE MODIFICATIONS BELOW HERE ----

# create tidy data set with coverage by direction
df <- lichen %>%
  select(coverage_north, coverage_east, coverage_south, coverage_west, 
         tree_density, sample_location) %>%
  pivot_longer(names_to = "tree_side", values_to = "coverage", 1:4) %>%
  separate(tree_side, into = c("tmp", "direction"), sep = "_") %>%
  select(-tmp)

# calculate summary stats
summary <- df %>%
  group_by(direction, tree_density, sample_location) %>%
  summarize(mean = mean(coverage),
            sd = sd(coverage))

# create plot
ggplot(summary) +
  geom_pointrange(aes(x = direction,
                    y = mean,
                    ymin = mean-sd,
                    ymax = mean+sd,
                    color = direction),
                size = 0.75) +
  facet_grid(sample_location ~ tree_density) +
  scale_color_manual(values = col_side) +
  labs(x = x_axis_title, 
       y = y_axis_title) +
  theme(legend.position = "none")

# test relationship
aov(coverage ~ tree_density + direction + sample_location,
    data = df) %>%
  summary()

```

Again, we see that tree density and sample location create different patterns of lichen coverage across the different sides of trees.


## What can we learn from our explanatory variables?

Recall, that we learned that the key requirements for lichen habitat are: **water, air, nutrients, light**,and **substrate type**.

-   **Water.** Lichens easily absorb water and water vapor through the outer layer of cells (**cortex)**, but lack mechanisms to conserve water during drought periods. The water content of lichens is determined by their surrounding environment: lichens lose water, dry up, and become dormant during dry periods, and re-hydrate and become photosynthetically active when moisture is available.
-   **Air.** Not only do lichens absorb water from surrounding air, lichens also absorb nutrients and pollutants. As a results, they are sensitive to many air-borne pollutants, and the presence and abundance of some species of lichen are reduced in areas high in atmospheric pollution. For example, sulfur dioxide (SO2) combines with moisture in the atmosphere to form sulfurous acid (H2SO3) or sulfuric acid (H2SO4). High levels of SO2 pollution are associated with decreased lichen respiration and photosynthesis, deactivation of enzymes resulting in reduced metabolic activity and reduced membrane integrity.
-   **Nutrients.** Nutrients (e.g., nitrogen, carbon, oxygen) are needed for cellular processes that support lichen growth and survival. Lichens obtain their nutrients from air and water, and, to a lesser extent, their substrate.
-   **Light.** Lichens are able to fix energy and carbon using photosynthesis and, thus, they require light + carbon dioxide + water.
-   **Substrate.** Lichens require a substrate to attach to, and can be found on both natural (e.g., trees, rocks, soil) and artificial substrates (e.g., tombstones, buildings, abandoned equipment). Furthermore, characteristics of the substrate can influence how lichens interact with other aspects of their habitat. For example, substrate pH (e.g., limestone, tree bark with high (basic) pH) can counteract the acidity of SO2 pollution, so that in high pollution areas lichens may be found only on sites with high (basics) pH.

::: {.callout-tip title="Consider this"}

With the exception of substrate type (tree type), we did not measure any of those requirements directly. Therefore, it is important for us to consider how the variables that we did measure relate to those requirements and how we can better understand how the presence, abundance, and distribution of lichen.

Think about how the parameters that you have measured related to these four categories. You will want to use this information both to formulate your research question and also when you interpret your results.

:::
